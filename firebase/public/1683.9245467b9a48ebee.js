"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1683],{1683:(q,h,d)=>{d.r(h),d.d(h,{RegistrarEntradaSalidaPageModule:()=>I});var v=d(6814),o=d(95),i=d(9810),b=d(1147),u=d(5861),R=d(203),t=d(9212);let T=(()=>{var r;class l{constructor(e,a){this.formBuilder=e,this.modalController=a}ngOnInit(){this.formulario=this.formBuilder.group({inventario_inical:[this.registro.inventario_inical,o.kI.required],compra:[this.registro.compra,o.kI.required],venta:[this.registro.venta,o.kI.required],inventario_final:[this.registro.inventario_final,o.kI.required]})}onSubmit(){this.formulario.valid?this.modalController.dismiss(this.formulario.value):console.log("El formulario no es v\xe1lido")}dismissModal(){this.modalController.dismiss()}}return(r=l).\u0275fac=function(e){return new(e||r)(t.Y36(o.qu),t.Y36(i.IN))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-editar-registro-pipas"]],inputs:{registro:"registro"},standalone:!0,features:[t.jDz],decls:25,vars:1,consts:[[2,"--background","#2c3d50"],[2,"color","white"],["slot","end"],[2,"color","white",3,"click"],[1,"ion-padding",2,"padding-top","3%"],["color","warning",1,"text-center"],[3,"formGroup","ngSubmit"],["label","Inventario Inicial","labelPlacement","floating","formControlName","inventario_inical","type","text"],["label","Compra","labelPlacement","floating","formControlName","compra","type","text"],["label","Venta","labelPlacement","floating","formControlName","venta","type","text"],["label","Inventario Final","labelPlacement","floating","formControlName","inventario_final","type","text"],["type","submit","expand","full",2,"padding-top","5%"]],template:function(e,a){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title",1),t._uU(3,"Editar Registro de Pipas"),t.qZA(),t.TgZ(4,"ion-buttons",2)(5,"ion-button",3),t.NdJ("click",function(){return a.dismissModal()}),t._uU(6,"Cancelar"),t.qZA()()()(),t.TgZ(7,"ion-content",4)(8,"ion-card",5)(9,"ion-card-header")(10,"ion-card-title"),t._uU(11,"Registro de entrada/salida"),t.qZA(),t.TgZ(12,"ion-card-subtitle"),t._uU(13,"Favor de ingresar la infromaci\xf3n correspondiente para registrar un ingreso/egreso un pipa"),t.qZA()()(),t.TgZ(14,"form",6),t.NdJ("ngSubmit",function(){return a.onSubmit()}),t.TgZ(15,"ion-item"),t._UZ(16,"ion-input",7),t.qZA(),t.TgZ(17,"ion-item"),t._UZ(18,"ion-input",8),t.qZA(),t.TgZ(19,"ion-item"),t._UZ(20,"ion-input",9),t.qZA(),t.TgZ(21,"ion-item"),t._UZ(22,"ion-input",10),t.qZA(),t.TgZ(23,"ion-button",11),t._uU(24,"Guardar"),t.qZA()()()),2&e&&(t.xp6(14),t.Q6J("formGroup",a.formulario))},dependencies:[v.ez,o.u5,o._Y,o.JJ,o.JL,i.Pc,i.YG,i.Sm,i.PM,i.Zi,i.tO,i.Dq,i.W2,i.Gu,i.pK,i.Ie,i.wd,i.sr,i.j9,o.UX,o.sg,o.u]}),l})();var _=d(2276),P=d(8056),E=d(4228);function S(r,l){if(1&r&&(t.TgZ(0,"ion-select-option",25),t._uU(1),t.qZA()),2&r){const n=l.$implicit;t.s9C("value",n.id),t.xp6(),t.Oqu(n.clave_pipa)}}function y(r,l){if(1&r){const n=t.EpF();t.TgZ(0,"ion-header")(1,"ion-toolbar",11),t._UZ(2,"ion-buttons",12),t.TgZ(3,"ion-buttons",13)(4,"ion-button",14),t.NdJ("click",function(){t.CHM(n);const a=t.oxw();return t.KtG(a.cancel())}),t._uU(5,"Cancelar"),t.qZA()()()(),t.TgZ(6,"ion-content",15)(7,"ion-card",16)(8,"ion-card-header")(9,"ion-card-title"),t._uU(10,"Registro de entrada/salida"),t.qZA(),t.TgZ(11,"ion-card-subtitle"),t._uU(12,"Favor de ingresar la infromaci\xf3n correspondiente para registrar un ingreso/egreso un pipa"),t.qZA()()(),t.TgZ(13,"form",17),t.NdJ("ngSubmit",function(){t.CHM(n);const a=t.oxw();return t.KtG(a.onSubmit())}),t.TgZ(14,"ion-item")(15,"ion-select",18),t.YNc(16,S,2,2,"ion-select-option",19),t.qZA()(),t.TgZ(17,"ion-item"),t._UZ(18,"ion-input",20),t.qZA(),t.TgZ(19,"ion-item"),t._UZ(20,"ion-input",21),t.qZA(),t.TgZ(21,"ion-item"),t._UZ(22,"ion-input",22),t.qZA(),t.TgZ(23,"ion-item"),t._UZ(24,"ion-input",23),t.qZA(),t.TgZ(25,"ion-button",24),t._uU(26,"Guardar"),t.qZA()()()}if(2&r){const n=t.oxw();t.xp6(4),t.Q6J("strong",!0),t.xp6(9),t.Q6J("formGroup",n.formularioRegistro),t.xp6(3),t.Q6J("ngForOf",n.pipas)}}const C=[{path:"",component:(()=>{var r;class l{constructor(e,a,g,c,s,f,m,p){this.api=e,this.storage=a,this.modal=g,this.formBuilder=c,this.toastController=s,this.alertController=f,this.modalController=m,this.route=p}ngOnInit(){this.storage.getUserLogged()||(this.storage.logout(),this.route.navigate(["/login"],{replaceUrl:!0}))}ionViewDidEnter(){var e=this;return(0,u.Z)(function*(){yield e.getInformacion(),e.formularioRegistro=e.formBuilder.group({id_planta:[e.token.user.id_planta,o.kI.required],id_pipa:["",o.kI.required],inventario_inical:["",o.kI.required],compra:["",o.kI.required],venta:["",o.kI.required],inventario_final:["",o.kI.required]})})()}getInformacion(){var e=this;return(0,u.Z)(function*(){e.token=e.storage.getUserData(),(yield e.api.getRegistroPipasES(e.token.token,e.token.user.id_planta)).subscribe({next:a=>{e.registros=a,console.log("\u{1f680} ~ RegistrarEntradaSalidaPage ~ val:",a),e.generarTablaRegistroPipa(a)},error:a=>{console.log(a)}}),(yield e.api.getPipas(e.token.token,e.token.user.id_planta)).subscribe({next:a=>{e.pipas=a},error:a=>{console.log(a)}})})()}generarTablaRegistroPipa(e){var a=this;return(0,u.Z)(function*(){_.fn.DataTable.isDataTable("#listaRegistroPipas")&&_("#listaRegistroPipas").DataTable().destroy(),setTimeout(()=>{},300),new R.Z("#listaRegistroPipas",{destroy:!0,language:{url:"/assets/utils/es-ES.json"},columns:[{data:"pipa.clave_pipa",title:"Calve ID"},{data:"inventario_inical",title:"Inventario Inicial"},{data:"compra",title:"Compra"},{data:"venta",title:"Venta"},{data:"inventario_final",title:"Inventario Final"},{title:"Operaciones",searchable:!1,data:null}],data:e,createdRow:(c,s,f)=>{const m=document.createElement("ion-button");m.setAttribute("size","small"),m.innerHTML='<ion-icon name="create"></ion-icon>',m.addEventListener("click",()=>a.abrirModalEditarRegistroPipa(s.id)),m.style.marginRight="15%";const p=document.createElement("ion-button");p.setAttribute("size","small"),p.setAttribute("color","danger"),p.innerHTML='<ion-icon name="trash"></ion-icon>',p.addEventListener("click",()=>a.eliminarRegistro(s.id));const Z=c.getElementsByTagName("td")[5];Z.innerHTML="",Z.appendChild(m),Z.appendChild(p)}})})()}abrirModalEditarRegistroPipa(e){var a=this;return(0,u.Z)(function*(){const g=a.registros.find(f=>f.id===e),c=yield a.modalController.create({component:T,componentProps:{registro:g}});yield c.present();const{data:s}=yield c.onWillDismiss();s&&(console.log("\u{1f680} ~ RegistrarEntradaSalidaPage ~ abrirModalEditarRegistroPipa ~ data:",s),(yield a.api.editRegistroPipasES(e,s,a.token.token)).subscribe({next:f=>{a.presentToast("bottom","Registro editado correctamente","success"),setTimeout(()=>{window.location.reload()},1e3)},error:f=>{a.presentToast("bottom","Error al editar el registro","danger")}}))})()}eliminarRegistro(e){var a=this;return(0,u.Z)(function*(){var c;yield(yield a.alertController.create({header:"Confirmar Eliminaci\xf3n",message:"\xbfEst\xe1s seguro de que deseas eliminar este registro?",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Eliminaci\xf3n cancelada")}},{text:"Eliminar",handler:(c=(0,u.Z)(function*(){try{(yield a.api.deleteRegistroPipasES(e,a.token.token)).subscribe(s=>{a.presentToast("bottom","Registro eliminado correctamente","success"),setTimeout(()=>{window.location.reload()},1e3)})}catch(s){console.error("Error al eliminar el registro",s),a.presentToast("bottom","Error al eliminar el registro","danger")}}),function(){return c.apply(this,arguments)})}]})).present()})()}presentToast(e,a,g){var c=this;return(0,u.Z)(function*(){yield(yield c.toastController.create({message:a,duration:1500,position:e,color:g})).present()})()}onSubmit(){var e=this;return(0,u.Z)(function*(){e.formularioRegistro.valid?(yield e.api.createRegistroPipasES(e.formularioRegistro.value,e.token.token)).subscribe({next:a=>{e.presentToast("bottom","Se ha generado un nuevo registro","success"),e.formularioRegistro.reset(),e.modal.dismiss(),setTimeout(()=>{window.location.reload()},1e3)},error:a=>{console.log("\u{1f680} ~ RegistrarEntradaSalidaPage ~ err:",a),e.presentToast("bottom","Algo ha salido mal","danger")}}):console.log("El formulario no es v\xe1lido")})()}cancel(){this.modal.dismiss(null,"cancel")}}return(r=l).\u0275fac=function(e){return new(e||r)(t.Y36(P.Z),t.Y36(E.V),t.Y36(i.IN),t.Y36(o.qu),t.Y36(i.yF),t.Y36(i.Br),t.Y36(i.IN),t.Y36(b.F0))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-registrar-entrada-salida"]],decls:17,vars:1,consts:[[3,"fullscreen"],[1,"card","ion-margin","rounded"],[1,"card-hedaer","text-white","ion-padding",2,"background","#2c3d50"],[1,"row"],[1,"col-md-10","pt-2"],[1,"col-md-2",2,"text-align","center"],["id","agregarRegistroEntradaSalidaModal","color","light"],["slot","start","name","add"],["trigger","agregarRegistroEntradaSalidaModal"],[1,"table-responsive","p-2"],["id","listaRegistroPipas",1,"table"],[2,"--background","#2c3d50"],["slot","start"],["slot","end"],[2,"color","white",3,"strong","click"],[1,"ion-padding"],["color","warning",1,"text-center"],[3,"formGroup","ngSubmit"],["label","Seleccione una pipa/autotanque","formControlName","id_pipa","labelPlacement","floating"],[3,"value",4,"ngFor","ngForOf"],["label","Inventario Inicial","labelPlacement","floating","formControlName","inventario_inical","type","text"],["label","Compra","labelPlacement","floating","formControlName","compra","type","text"],["label","Venta","labelPlacement","floating","formControlName","venta","type","text"],["label","Inventario Final","labelPlacement","floating","formControlName","inventario_final","type","text"],["type","submit","expand","full",2,"padding-top","5%"],[3,"value"]],template:function(e,a){1&e&&(t.TgZ(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4"),t._uU(6,"Lista de registros entradas/salidas"),t.qZA()(),t.TgZ(7,"div",5)(8,"ion-button",6),t._UZ(9,"ion-icon",7),t._uU(10," Agregar "),t._UZ(11,"br"),t._uU(12," registro "),t.qZA(),t.TgZ(13,"ion-modal",8),t.YNc(14,y,27,3,"ng-template"),t.qZA()()()(),t.TgZ(15,"div",9),t._UZ(16,"table",10),t.qZA()()()),2&e&&t.Q6J("fullscreen",!0)},dependencies:[v.sg,o._Y,o.JJ,o.JL,i.YG,i.Sm,i.PM,i.Zi,i.tO,i.Dq,i.W2,i.Gu,i.gu,i.pK,i.Ie,i.t9,i.n0,i.sr,i.ki,i.QI,i.j9,o.sg,o.u]}),l})()}];let x=(()=>{var r;class l{}return(r=l).\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[b.Bz.forChild(C),b.Bz]}),l})(),I=(()=>{var r;class l{}return(r=l).\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[v.ez,o.u5,i.Pc,x,o.UX]}),l})()}}]);