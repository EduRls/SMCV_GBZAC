"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3404],{3404:(q,h,u)=>{u.r(h),u.d(h,{ListaUsuariosPageModule:()=>L});var U=u(6814),i=u(95),r=u(9810),Z=u(1147),d=u(5861),T=u(203),o=u(9212);function v(a,s){if(1&a&&(o.TgZ(0,"ion-select-option",13),o._uU(1),o.qZA()),2&a){const n=s.$implicit;o.s9C("value",n.id),o.xp6(),o.Oqu(n.rol)}}let _=(()=>{var a;class s{constructor(e,t,l){this.modalController=e,this.formBuilder=t,this.toastController=l}presentToast(e,t,l){var c=this;return(0,d.Z)(function*(){yield(yield c.toastController.create({message:t,duration:1500,position:e,color:l})).present()})()}ngOnInit(){this.formularioEditarUsuario=this.formBuilder.group({name:[this.usuario[0].name,i.kI.required],id_rol_usuario:[this.usuario[0].id_rol_usuario,i.kI.required],email:[this.usuario[0].email,i.kI.required],password:[""]})}cerrarModal(){this.modalController.dismiss()}onSubmit(){this.formularioEditarUsuario.valid?this.modalController.dismiss(this.formularioEditarUsuario.value):this.presentToast("bottom","Favor de verificar los campos","warning")}}return(a=s).\u0275fac=function(e){return new(e||a)(o.Y36(r.IN),o.Y36(i.qu),o.Y36(r.yF))},a.\u0275cmp=o.Xpm({type:a,selectors:[["app-editar-usuario"]],inputs:{usuario:"usuario",rolesUsuario:"rolesUsuario"},standalone:!0,features:[o.jDz],decls:26,vars:3,consts:[[2,"--background","#2c3d50"],[2,"color","white"],["slot","end"],[2,"color","white",3,"strong","click"],[1,"ion-padding"],["color","warning",1,"text-center"],[3,"formGroup","ngSubmit"],["label","Nombre del usuario","labelPlacement","floating","formControlName","name","type","text","placeholder","Ingrese el nombre del usuario"],["label","Correo electr\xf3nico","labelPlacement","floating","formControlName","email","type","text","placeholder","Ingrese el correo electr\xf3nico del usuario"],["label","Contrase\xf1a","labelPlacement","floating","formControlName","password","type","text","placeholder","Ingrese una contrase\xf1a para el usuario"],["label","Rol de usuario","formControlName","id_rol_usuario","labelPlacement","floating"],[3,"value",4,"ngFor","ngForOf"],["type","submit","expand","full",2,"padding-top","2%"],[3,"value"]],template:function(e,t){1&e&&(o.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title",1),o._uU(3,"Editar Medidor"),o.qZA(),o.TgZ(4,"ion-buttons",2)(5,"ion-button",3),o.NdJ("click",function(){return t.cerrarModal()}),o._uU(6,"Cancelar"),o.qZA()()()(),o.TgZ(7,"ion-content",4)(8,"ion-card",5)(9,"ion-card-header")(10,"ion-card-title"),o._uU(11,"Registro de usuario"),o.qZA(),o.TgZ(12,"ion-card-subtitle"),o._uU(13,"Favor de ingresar la infromaci\xf3n correspondiente para registrar un usuario"),o.qZA()()(),o.TgZ(14,"form",6),o.NdJ("ngSubmit",function(){return t.onSubmit()}),o.TgZ(15,"ion-item"),o._UZ(16,"ion-input",7),o.qZA(),o.TgZ(17,"ion-item"),o._UZ(18,"ion-input",8),o.qZA(),o.TgZ(19,"ion-item"),o._UZ(20,"ion-input",9),o.qZA(),o.TgZ(21,"ion-item")(22,"ion-select",10),o.YNc(23,v,2,2,"ion-select-option",11),o.qZA()(),o.TgZ(24,"ion-button",12),o._uU(25,"Guardar"),o.qZA()()()),2&e&&(o.xp6(5),o.Q6J("strong",!0),o.xp6(9),o.Q6J("formGroup",t.formularioEditarUsuario),o.xp6(9),o.Q6J("ngForOf",t.rolesUsuario))},dependencies:[U.ez,U.sg,r.Pc,r.YG,r.Sm,r.PM,r.Zi,r.tO,r.Dq,r.W2,r.Gu,r.pK,r.Ie,r.t9,r.n0,r.wd,r.sr,r.QI,r.j9,i.UX,i._Y,i.JJ,i.JL,i.sg,i.u,i.u5]}),s})();var C=u(4228),y=u(8056),A=u(7973);function x(a,s){if(1&a&&(o.TgZ(0,"ion-select-option",24),o._uU(1),o.qZA()),2&a){const n=s.$implicit;o.s9C("value",n.id),o.xp6(),o.Oqu(n.rol)}}function F(a,s){if(1&a){const n=o.EpF();o.TgZ(0,"ion-header")(1,"ion-toolbar",11),o._UZ(2,"ion-buttons",12),o.TgZ(3,"ion-buttons",13)(4,"ion-button",14),o.NdJ("click",function(){o.CHM(n);const t=o.oxw();return o.KtG(t.cancel())}),o._uU(5,"Cancelar"),o.qZA()()()(),o.TgZ(6,"ion-content",15)(7,"ion-card",16)(8,"ion-card-header")(9,"ion-card-title"),o._uU(10,"Registro de usuario"),o.qZA(),o.TgZ(11,"ion-card-subtitle"),o._uU(12,"Favor de ingresar la infromaci\xf3n correspondiente para registrar un usuario"),o.qZA()()(),o.TgZ(13,"form",17),o.NdJ("ngSubmit",function(){o.CHM(n);const t=o.oxw();return o.KtG(t.onSubmit())}),o.TgZ(14,"ion-item"),o._UZ(15,"ion-input",18),o.qZA(),o.TgZ(16,"ion-item"),o._UZ(17,"ion-input",19),o.qZA(),o.TgZ(18,"ion-item"),o._UZ(19,"ion-input",20),o.qZA(),o.TgZ(20,"ion-item")(21,"ion-select",21),o.YNc(22,x,2,2,"ion-select-option",22),o.qZA()(),o.TgZ(23,"ion-button",23),o._uU(24,"Guardar"),o.qZA()()()}if(2&a){const n=o.oxw();o.xp6(4),o.Q6J("strong",!0),o.xp6(9),o.Q6J("formGroup",n.formularioUsuario),o.xp6(9),o.Q6J("ngForOf",n.rolesUsuario)}}const P=[{path:"",component:(()=>{var a;class s{constructor(e,t,l,c,m,g){this.storage=e,this.api=t,this.toastController=l,this.modal=c,this.formBuilder=m,this.authService=g}ngOnInit(){var e=this;return(0,d.Z)(function*(){yield e.getInformacion()})()}presentToast(e,t,l){var c=this;return(0,d.Z)(function*(){yield(yield c.toastController.create({message:t,duration:1500,position:e,color:l})).present()})()}getInformacion(){var e=this;return(0,d.Z)(function*(){e.userToken=e.storage.getUserData(),(yield e.api.getRolUsuario(e.userToken.token)).subscribe({next:t=>{e.rolesUsuario=t},error:t=>{console.log(t)}}),(yield e.api.getUsuarios(e.userToken.token,e.userToken.user.id_planta)).subscribe({next:t=>{e.usuariosLista=t,e.generarTablaUsuarios(e.usuariosLista)},error:t=>{console.log(t)}}),yield e.generarFormulario()})()}generarFormulario(){var e=this;return(0,d.Z)(function*(){e.formularioUsuario=e.formBuilder.group({name:["",i.kI.required],id_planta:[e.userToken.user.id_planta,i.kI.required],id_rol_usuario:["",i.kI.required],email:["",i.kI.required],password:["",i.kI.required]})})()}generarTablaUsuarios(e){var t=this;return(0,d.Z)(function*(){setTimeout(()=>{},300),new T.Z("#listaUsuarios",{language:{url:"/assets/utils/es-ES.json"},columns:[{data:"name",title:"Nombre de usuario"},{data:"planta.nombre_planta",title:"Nombre de planta"},{data:"rol.rol",title:"Rol de usuario"},{title:"Operaciones",orderable:!1,searchable:!1,data:null}],data:e,createdRow:(c,m,g)=>{const p=document.createElement("ion-button");p.setAttribute("size","small"),p.innerHTML='<ion-icon name="create"></ion-icon>',p.addEventListener("click",()=>t.abrirModalEditarUsuario(m.id)),p.style.marginRight="15%";const f=document.createElement("ion-button");f.setAttribute("size","small"),f.setAttribute("color","danger"),f.innerHTML='<ion-icon name="trash"></ion-icon>',f.addEventListener("click",()=>t.eliminarUsuario(m.id));const b=c.getElementsByTagName("td")[3];b.innerHTML="",b.appendChild(p),b.appendChild(f)}}).draw()})()}abrirModalEditarUsuario(e){var t=this;return(0,d.Z)(function*(){const l=t.usuariosLista.filter(g=>g.id===e),c=yield t.modal.create({component:_,componentProps:{usuario:l,rolesUsuario:t.rolesUsuario}});yield c.present();const{data:m}=yield c.onDidDismiss();m&&(yield t.api.editUsuario(e,m,t.userToken.token)).subscribe({next:g=>{t.presentToast("bottom","Se ha editado un nvueo usuario","success"),setTimeout(()=>{t.userToken.user.id==e?t.logout():window.location.reload()},300)},error:g=>{t.presentToast("bottom","Algo ha salido mal","danger")}})})()}logout(){var e=this;return(0,d.Z)(function*(){e.storage.logout(),e.authService.logout()})()}eliminarUsuario(e){var t=this;return(0,d.Z)(function*(){(yield t.api.deleteUsuario(e,t.userToken.token)).subscribe({next:l=>{t.presentToast("bottom","Se ha eliminado un usuario","success"),setTimeout(()=>{window.location.reload()},300)},error:l=>{t.presentToast("bottom","Algo ha salido mal","danger")}})})()}onSubmit(){var e=this;return(0,d.Z)(function*(){console.log(e.formularioUsuario.value),e.formularioUsuario.valid?(yield e.api.createUsuario(e.formularioUsuario.value,e.userToken.token)).subscribe({next:t=>{e.presentToast("bottom","Se ha creado un nvueo usuario","success"),setTimeout(()=>{window.location.reload()},300)},error:t=>{e.presentToast("bottom","Algo ha salido mal","danger")}}):e.presentToast("bottom","Favor de verificar los campos","warning")})()}cancel(){this.modal.dismiss(null,"cancel")}}return(a=s).\u0275fac=function(e){return new(e||a)(o.Y36(C.V),o.Y36(y.Z),o.Y36(r.yF),o.Y36(r.IN),o.Y36(i.qu),o.Y36(A.e))},a.\u0275cmp=o.Xpm({type:a,selectors:[["app-lista-usuarios"]],decls:17,vars:1,consts:[[3,"fullscreen"],[1,"card","ion-margin","rounded"],[1,"card-hedaer","text-white","ion-padding",2,"background","#2c3d50"],[1,"row"],[1,"col-md-10","pt-2"],[1,"col-md-2",2,"text-align","center"],["id","agregarUsuarioModal","color","light"],["slot","start","name","add"],["trigger","agregarUsuarioModal"],[1,"table-responsive","p-2"],["id","listaUsuarios",1,"table"],[2,"--background","#2c3d50"],["slot","start"],["slot","end"],[2,"color","white",3,"strong","click"],[1,"ion-padding"],["color","warning",1,"text-center"],[3,"formGroup","ngSubmit"],["label","Nombre del usuario","labelPlacement","floating","formControlName","name","type","text","placeholder","Ingrese el nombre del usuario"],["label","Correo electr\xf3nico","labelPlacement","floating","formControlName","email","type","text","placeholder","Ingrese el correo electr\xf3nico del usuario"],["label","Contrase\xf1a","labelPlacement","floating","formControlName","password","type","text","placeholder","Ingrese una contrase\xf1a para el usuario"],["label","Rol de usuario","formControlName","id_rol_usuario","labelPlacement","floating"],[3,"value",4,"ngFor","ngForOf"],["type","submit","expand","full",2,"padding-top","2%"],[3,"value"]],template:function(e,t){1&e&&(o.TgZ(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4"),o._uU(6,"Lista de usuarios"),o.qZA()(),o.TgZ(7,"div",5)(8,"ion-button",6),o._UZ(9,"ion-icon",7),o._uU(10," Agregar "),o._UZ(11,"br"),o._uU(12," Usuario "),o.qZA(),o.TgZ(13,"ion-modal",8),o.YNc(14,F,25,3,"ng-template"),o.qZA()()()(),o.TgZ(15,"div",9),o._UZ(16,"table",10),o.qZA()()()),2&e&&o.Q6J("fullscreen",!0)},dependencies:[U.sg,i._Y,i.JJ,i.JL,r.YG,r.Sm,r.PM,r.Zi,r.tO,r.Dq,r.W2,r.Gu,r.gu,r.pK,r.Ie,r.t9,r.n0,r.sr,r.ki,r.QI,r.j9,i.sg,i.u]}),s})()}];let k=(()=>{var a;class s{}return(a=s).\u0275fac=function(e){return new(e||a)},a.\u0275mod=o.oAB({type:a}),a.\u0275inj=o.cJS({imports:[Z.Bz.forChild(P),Z.Bz]}),s})(),L=(()=>{var a;class s{}return(a=s).\u0275fac=function(e){return new(e||a)},a.\u0275mod=o.oAB({type:a}),a.\u0275inj=o.cJS({imports:[U.ez,i.u5,r.Pc,k,i.UX]}),s})()}}]);